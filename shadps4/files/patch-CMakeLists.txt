--- CMakeLists.txt.orig	2025-03-27 20:40:40 UTC
+++ CMakeLists.txt
@@ -14,6 +14,8 @@ if (NOT CMAKE_BUILD_TYPE)
 
 if (NOT CMAKE_BUILD_TYPE)
     set(CMAKE_BUILD_TYPE Release)
+else()
+    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O0 -g -fno-omit-frame-pointer -Wall -Wextra")
 endif()
 
 project(shadPS4 CXX C ASM ${ADDITIONAL_LANGUAGES})
@@ -33,7 +35,23 @@ option(ENABLE_UPDATER "Enables the options to updater"
 option(ENABLE_QT_GUI "Enable the Qt GUI. If not selected then the emulator uses a minimal SDL-based UI instead" OFF)
 option(ENABLE_DISCORD_RPC "Enable the Discord RPC integration" ON)
 option(ENABLE_UPDATER "Enables the options to updater" ON)
+option(ENABLE_SANITIZERS "Enable Address and Undefined Behavior Sanitizers" OFF)
 
+if(ENABLE_SANITIZERS)
+    message(STATUS "Sanitizers enabled")
+
+    # Set sanitizer flags
+    set(SANITIZER_FLAGS "-fsanitize=address,undefined -fno-omit-frame-pointer")
+
+    # Append to existing flags
+    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${SANITIZER_FLAGS}")
+    set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} ${SANITIZER_FLAGS}")
+
+    # For linking as well
+    set(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} ${SANITIZER_FLAGS}")
+    set(CMAKE_SHARED_LINKER_FLAGS "${CMAKE_SHARED_LINKER_FLAGS} ${SANITIZER_FLAGS}")
+endif()
+
 # First, determine whether to use CMAKE_OSX_ARCHITECTURES or CMAKE_SYSTEM_PROCESSOR.
 if (APPLE AND CMAKE_OSX_ARCHITECTURES)
     set(BASE_ARCHITECTURE "${CMAKE_OSX_ARCHITECTURES}")
@@ -54,7 +72,7 @@ if (ARCHITECTURE STREQUAL "x86_64")
 
 if (ARCHITECTURE STREQUAL "x86_64")
     # Set x86_64 target level to Sandy Bridge to generally match what is supported for PS4 guest code with CPU patches.
-    add_compile_options(-march=sandybridge)
+#    add_compile_options(-march=sandybridge)
 endif()
 
 if (APPLE AND ARCHITECTURE STREQUAL "x86_64" AND CMAKE_HOST_SYSTEM_PROCESSOR STREQUAL "arm64")
@@ -1189,7 +1207,7 @@ install(TARGETS shadps4 BUNDLE DESTINATION .)
 # Install rules
 install(TARGETS shadps4 BUNDLE DESTINATION .)
 
-if (ENABLE_QT_GUI AND CMAKE_SYSTEM_NAME STREQUAL "Linux")
+if (ENABLE_QT_GUI AND CMAKE_SYSTEM_NAME STREQUAL "Linux" OR CMAKE_SYSTEM_NAME STREQUAL "FreeBSD")
     install(FILES "dist/net.shadps4.shadPS4.desktop" DESTINATION "share/applications")
     install(FILES "dist/net.shadps4.shadPS4.metainfo.xml" DESTINATION "share/metainfo")
     install(FILES ".github/shadps4.png" DESTINATION "share/icons/hicolor/512x512/apps" RENAME "net.shadps4.shadPS4.png")
